{%- assign swatch_file_extension = 'png' -%}

<div class="variant-wrapper small--text-center js" data-type="button">
  <label class="variant__label{% if option.name == 'Default' or option.name == 'Title' %} hidden-label{% endif %}{% unless variant_labels %} hidden-label{% endunless %}"
    for="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ forloop.index0 }}">
    {{ option.name }}
    {%- if option.name == 'Color' -%}
      <span class="variant__label-info">
        &mdash;
        <span
          data-color-label
          data-color-label-index="{{ forloop.index0 }}"
          data-option-index="{{ color_option_index }}">
          {{ option.selected_value }}
        </span>
      </span>
    {%- endif -%}
  </label>
  {%- assign option_index = forloop.index -%}
  <fieldset class="variant-input-wrap {{ option.name | handleize }}"
    name="{{ option.name }}"
    data-index="option{{ option_index }}"
    data-handle="{{ option.name | handleize }}"
    id="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ forloop.index0 }}">
    <legend class="hide">{{ option.name }}</legend>
    {%- for value in option.values -%}
      {%- assign product_available = true -%}
      {%- if product.options.size == 1 -%}
        {%- assign product_available = product.variants[forloop.index0].available -%}
      {%- endif -%}
      {%- unless product_available == false -%}
        <div
          class="variant-input"
          data-index="option{{ option_index }}"
          data-value="{{ value | escape }}">
          <input type="radio"
            form="{{ form_id }}"
            {% if option.selected_value == value and product_available %} checked="checked"{% endif %}
            value="{{ value | escape }}"
            data-index="option{{ option_index }}"
            name="{{ option.name }}"
            data-variant-input
            {% if is_color %}data-color-swatch{% endif %}
            class="variant__input-{{ section_id }}{% unless product_available %} disabled{% endunless %}"
            {% if is_color %} data-color-name="{{ value | escape }}"{% endif %}
            {% if is_color %} data-color-index="{{ color_option_index }}"{% endif %}
            id="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ option.name | handleize }}-{{ value | url_encode }}">
          {%- if is_color -%}
            {%- liquid
              assign color_file_name = value | handle | append: '.' | append: swatch_file_extension
              assign color_image = color_file_name | file_img_url: '50x50' | prepend: 'https:' | split: '?' | first
              assign color_swatch_fallback = value | split: ' ' | last | handle
  
              for image in product.variants[forloop.index0].metafields.custom.image_variant.value
                if forloop.first
                  assign imageVariant = image 
                endif
              endfor
  
            -%}
            <label
              data-image="{{ imageVariant.id }}"
              for="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ option.name | handleize }}-{{ value | url_encode }}"
              class="color-swatch color-swatch--{{ value | handle }}{% unless product_available %} disabled{% endunless %}"
              style="background-color: {{ color_swatch_fallback }};{% if images[color_file_name] != blank %}  background-image: url({{ color_image }});{% endif %}"
            >
              {{ value | escape }}
            </label>
          {%- else -%}
  
          {%- liquid
            for image in product.variants[forloop.index0].metafields.custom.image_variant.value
            if forloop.first
              assign imageVariant = image 
            endif
          endfor
          -%}
  
            <label data-image="{{ imageVariant.id }}" for="ProductSelect-{{ section_id }}-{{ product.id }}-option-{{ option.name | handleize }}-{{ value | url_encode }}"{% unless product_available %} class="disabled"{% endunless %}>{{ value | escape }}</label>
          {%- endif -%}
        </div>
      {%- endunless -%}
    {%- endfor -%}
  </fieldset>
</div>
