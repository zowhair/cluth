let progressGamification=function(t,o,e,r,a,i){r.slice(-1)[0].value;setTimeout(function(){let t=200<o?100:125<o&&o<200?(o-125)/75*16+59:75<o&&o<125?(o-75)/75*18+28:30<o&&40<o?15:o<30?0:0;if(Rebuy.SmartCart.gamificationCluch.width={width:t+"%"},2==i&&1==r[i].complete)Rebuy.SmartCart.gamification.isLeft="<strong>Congrats!</strong> You get Expedited Shipping + 2 Freebies!";else if(-1==i&&1==r[2].complete)Rebuy.SmartCart.gamification.isLeft="<strong>Congrats!</strong> You get Expedited Shipping + 2 Freebies!";else{var e=r[i],a=o-e?.value/100,a=Math.abs(a);let t="";t=""==e?.product?`You're <strong>$${a.toFixed(2)}</strong> away from <strong>${e?.fallbackProduct}</strong>`:`You're <strong>$${a.toFixed(2)}</strong> away from <strong> a Free ${e?.product?.title}</strong>`,Rebuy.SmartCart.gamification.isLeft=t}},900),console.log("LAST ACTIVE: ",i,r)};function getCartData(){return fetch("/cart.js",{method:"GET"}).then(t=>t.json()).catch(t=>console.error("Error:",t))}let onRemoveItemGamification=function(t,e,a,o){const r=t?.detail?.product?.variant_id;a.find(t=>t===r.toString())&&(a[o].complete=!1)},addGifToCart=function(t,e,a,o){var r;""===e.id_product?(a[o].complete=!0,observerGamification(t)):(r=(window.Rebuy?.SmartCart?.cart?.items).find(t=>t?.product?.id===parseInt(e.id_product)),console.log("existe: ",r,t),r?a[o].complete=!0:((t={})[e.variant]=1,localStorage.getItem("gamification_goal:"+o),Rebuy.SmartCart.postData(window.Shopify.routes.root+"cart/update.js",{updates:t}).then(t=>{a[o].complete=!0,localStorage.setItem("gamification_goal:"+o,!0),console.log("AQUI TA JUAN:",window.Rebuy?.SmartCart?.cart?.items)})))},removeGiftToCart=function(t,e,a,o){if(""===e.id_product)return a[o].complete=!1,observerGamification(t),!1;var t=(window.Rebuy?.SmartCart?.cart?.items).find(t=>t?.product?.id===parseInt(e.id_product)),r={};let i=e.variant;r[i=t?t.variant_id:i]=0,Rebuy.SmartCart.postData(window.Shopify.routes.root+"cart/update.js",{updates:r}).then(t=>{a[o].complete=!1,localStorage.removeItem("gamification_goal:"+o)})},observerGamification=function(t){for(var e=window.Rebuy?.SmartCart?.cart?.total_price/100,a=Object.values(Rebuy.SmartCart.gamificationCluch.goals),o=0;o<a.length;o++){var r=a[o],i=r.value/100;if("rebuy:smartcart.product-removed"===t.type)return onRemoveItemGamification(t,r,a,o);var n=a.findIndex(t=>!1===t.complete);if(console.log("observer: ",this.name,", ",n),Rebuy.SmartCart.gamification.position=n,progressGamification(t,e,r,a,o,n),i<=e&&0==r.complete)return addGifToCart(t,r,a,o);if(e<=i&&1==r.complete)return removeGiftToCart(t,r,a,o)}document.querySelectorAll(".cart-link__bubble-num")&&getCartData().then(t=>{let e=t.item_count;document.querySelectorAll(".cart-link__bubble-num").forEach(t=>{t.textContent=e})})};const eventsToGamification=["rebuy:smartcart.init","rebuy:smartcart.product-removed","rebuy:cart.change"];document.addEventListener("DOMContentLoaded",function(){document.addEventListener("rebuy:cart.change",function(t){0==Rebuy.Cart.cart.items_count&&(localStorage.removeItem("gamification_goal:1"),localStorage.removeItem("gamification_goal:2"))}),eventsToGamification.map(t=>{document.addEventListener(t,t=>{setTimeout(()=>{observerGamification(t)},1500)})})}),document.addEventListener("rebuy:smartcart.init",function(o){Rebuy.SmartCart.changeVariant=function(t,e){var a={};a[t.target.value]=1,a[e]=0,Rebuy.SmartCart.postData(window.Shopify.routes.root+"cart/update.js",{updates:a}).then(t=>{observerGamification(o)})}});